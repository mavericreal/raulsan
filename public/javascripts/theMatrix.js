var MAX_LINES=25,MIN_LINE_LENGTH=8,MAX_LINE_LENGTH=32,lines=[],ctx=null,canvas=null,HEIGHT=0,WIDTH=0,CHARACTER_X=30,CHARACTER_Y=38,white_gradient="",green="#82D85A",interval=null;
function initMatrix(){canvas=document.getElementById("theMatrix");canvas.clear=true;ctx=canvas.getContext("2d");canvas.width=$(window).width();canvas.height=$(window).height();HEIGHT=canvas.height;WIDTH=canvas.width;white_gradient=ctx.createLinearGradient(0,0,CHARACTER_X,0);white_gradient.addColorStop(0,"#82D85A");white_gradient.addColorStop(0.9,"#82D85A");white_gradient.addColorStop(1,"#FFFFFF");interval=setInterval("drawMatrix()",100)}
function drawMatrix(){var b,f,c,d,a,e,g,h,i;lines.length<MAX_LINES&&lines.push(newLine());ctx.clearRect(0,0,WIDTH,HEIGHT);b=0;for(f=this.lines.length;b<f;b++){a=lines[b];h=CHARACTER_Y*a.scale;i=0;d=a.characters.length;a.yOffset+=a.ySpeed;d<Math.floor(a.yOffset/h)&&d<a.len&&a.characters.push(newCharacter());c=0;for(d=d;c<d;c++){e=a.characters[c];g=a.yStart+a.yOffset-i;i+=h;ctx.fillStyle=e.image==1?white_gradient:green;ctx.textBaseline="top";ctx.font="bold "+parseInt(a.scale*20)+"px serif";ctx.fillText(e.num,
a.xStart,g);if(e.dynamic||c==0)if(e.dynamicWait++>10){a.characters[c].image=1;a.characters[c].dynamic=true;a.characters[c].dynamicWait=0}if(c==a.len-1&&g>HEIGHT)lines[b]=newLine()}}}function newLine(){var b={xStart:randomInt(0,WIDTH),yStart:randomInt(0,HEIGHT/8)-200,yOffset:0,scale:randomInt(4,20)/10,len:randomInt(MIN_LINE_LENGTH,MAX_LINE_LENGTH),characters:[]};b.ySpeed=5/b.scale+randomInt(0,5);return b}
function newCharacter(){return{image:0,num:randomInt(0,1),dynamic:randomInt(0,10)==0,dynamicWait:0}}function randomInt(b,f){return Math.floor(Math.random()*(f-b+1)+b)};